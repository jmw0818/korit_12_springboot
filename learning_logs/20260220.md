# ğŸ“‚ 02.20 ìˆ˜ì—… ë‚´ìš©  
# ğŸ“ ì•ˆë‚´ì‚¬í•­
http://localhost:8080/h2-console

# ğŸŸ© JPAë¥¼ ì´ìš©í•œ DB ìƒì„± ë° ì ‘ê·¼

## ğŸŸ¢ JPA ì •ì˜
- Jakarta Persistence API ì˜ ì¶•ì•½ì–´ë¡œ ì—”í‹°í‹° í´ë˜ìŠ¤ë¥¼ í†µí•´ DB ë¥¼ ì •ì˜í•˜ëŠ” ë°©ë²•ì´ë‹¤.
- ì¦‰, HeidiSQLì„ í†µí•´ì„œ DBë¥¼ ìƒì„±í•˜ê³  TABLE ìƒì„±, COLUMN ì •ì˜í•˜ê³  SQLë¬¸ì„ í™œìš©í•˜ì—¬ rowë“¤ì„ ì¶”ê°€ / ìˆ˜ì • / ì‚­ì œ / ì¡°íšŒë¥¼ í–ˆë˜ ê²ƒê³¼ ë‹¬ë¦¬ SpringBoot í”„ë¡œì íŠ¸ ë‚´ì—ì„œ í•´ê²°ì„ í•œë‹¤.

## ğŸŸ¢ ORM 
- Object Relational Mapping : ê°ì²´ ì§€í–¥ í”„ë¡œê·¸ë˜ë° íŒ¨ëŸ¬ë‹¤ì„ì„ ì´ìš©í•˜ì—¬ DBë¥¼ ê°€ì ¸ì˜¤ê³  ë§¤í•‘í•  ìˆ˜ ìˆëŠ” ê¸°ìˆ (íŠ¹ì • Java ì½”ë“œê°€ SQL ë¬¸ì— ëŒ€ì‘ëœë‹¤ëŠ” ì˜ë¯¸)ì´ë‹¤. DB êµ¬ì¡°ë³´ë‹¤ëŠ” ê°ì²´ ì§€í–¥ ê°œë…ì„ ë°”íƒ•ì— ë‘ê³  ìˆì–´ Java í”„ë¡œê·¸ë˜ë¨¸ë“¤ì—ê²Œ ìœ ìš©í•˜ê³ , ë³„ê°œì˜ SQLë¬¸ì„ ìˆ™ë‹¬í•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— ê°œë°œ ì†ë„ ë° ì†ŒìŠ¤ ì½”ë“œì˜ ì–‘ì„ ì¤„ì—¬ì¤€ë‹¤. ê·¸ë¦¬ê³  ëŒ€ë¶€ë¶„ì˜ DBì— ë…ë¦½ì ì´ê¸° ë•Œë¬¸ì— DBMSì— ë”°ë¼ ì¡°ê¸ˆì”© ë‹¬ë¼ì§€ëŠ” SQLë¬¸ì˜ dialectì— ëŒ€í•´ ê±±ì •í•  í•„ìš”ê°€ ì—†ë‹¤. (ì¦‰, ì´ì‚¬ê°€ê¸°ê°€ ì‰½ë‹¤)

### JPA(ORM ë¹„êµ ìƒì—ì„œì˜)
- ì´ì „ì—ëŠ” Java Persistence APIë¼ê³  ë¶ˆë ¸ê³ , Java ê°œë°œìë¥¼ ìœ„í•œ ORMì„ ì œê³µí•œë‹¤. ì—¬ê¸°ì„œ JPA EntityëŠ” ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” êµ¬ì¡°ë¥¼ ë‚˜íƒ€ë‚´ëŠ” Java í´ë˜ìŠ¤ë¥¼ ì˜ë¯¸í•œë‹¤. ì¦‰, í´ë˜ìŠ¤ëŠ” í…Œì´ë¸” ëª…, fieldëª…ì€ columnëª…ìœ¼ë¡œ ëŒ€ì‘ë˜ê³ , ê±°ê¸°ì„œ ìƒì„±ë˜ëŠ” ê° ê°ì²´ì˜ field ê°’ë“¤ì˜ ì¡°í•©ì´ rowë¡œ ì´ë£¨ì–´ì§„ë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤.

## ğŸŸ¢ í•˜ì´ë²„ë„¤ì´íŠ¸(Hibernate)
- ìµœê·¼ì— ê°€ì¥ ì¸ê¸° ìˆëŠ” êµ¬í˜„ì²´ë©´ì„œ, SpringBoot ìƒì—ì„œì˜ ê¸°ë³¸ êµ¬í˜„ì²´ë¡œ ì‚¬ìš©ëœë‹¤. ê¸°ì—… ìˆ˜ì¤€ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ìì£¼ ì‚¬ìš©ëœë‹¤.

## ğŸŸ¢ Entity í´ë˜ìŠ¤ ë§Œë“¤ê¸°
- JPAì—ì„œ `@Entity` ì• ë„ˆí…Œì´ì…˜ì„ ì´ìš©í•˜ëŠ” Java í´ë˜ìŠ¤. ì—”í‹°í‹° í´ë˜ìŠ¤ëŠ” í‘œì¤€ ìë°” ë¹ˆì˜ ëª…ëª… ê·œì¹™ì„ ë”°ë¥´ë©°, ì ì ˆí•œ Getter / Setterë¥¼ ê°€ì§„ë‹¤.

- JPAëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì´ˆê¸°í™”ë  ë•Œ _í´ë˜ìŠ¤ ì´ë¦„ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì„ ìƒì„±_ í•œë‹¤. ê·¸ë˜ì„œ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì— ë‹¤ë¥¸ ì´ë¦„ì„ ëª…ëª…í•˜ê³  ì‹¶ë‹¤ë©´ ì—”í‹°í‹° í´ë˜ìŠ¤ì— `@Table(name="ì–´ì©Œê³ ")`ë¥¼ ì§€ì •í•´ì¤˜ì•¼ í•œë‹¤.
    - ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì ì´ User ì—”í‹°í‹° í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì—ˆì„ ë•Œ Userê°€ í…Œì´ë¸”ëª…ì´ ë˜ë©´ ì˜ˆì•½ì–´ë¼ì„œ ì˜¤ë¥˜ê°€ ë‚˜ëŠ” ê²½ìš°ê°€ ë§ì•„ `@Table(name = "users")`ë¡œ ì§€ì •í•´ì£¼ëŠ” ê²½ìš°ê¹Œì§€ê°€ ê¸°ë³¸ í…œí”Œë¦¿ì´ë‹¤.

```java
package com.korit12.cardatabase.domain;

import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;

@Entity
public class Car {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;
    
    private String brand, model, color, registrationNumber;
    
    private int modelYear, price;
}
```
- ì—”í‹°í‹° í´ë˜ìŠ¤ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê¸°ë³¸ í‚¤ë¡œ ì´ìš©ë˜ëŠ” ê³ ìœ í•œ IDë¥¼ í¬í•¨í•´ì•¼ í•œë‹¤. ê·¸ëŸ°ë° field ìƒì—ì„œ ê¸°ë³¸ í‚¤ê°€ ë¬´ì—‡ì¸ì§€ DBëŠ” ì•Œ ë°”ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì´ë¥¼ ëª…ì‹œí•˜ê¸° ìœ„í•´ì„œ `@Id`ë¥¼ ì´ìš©í•´ì„œ ì •ì˜í•œë‹¤.

- `@GeneratedValue` ì• ë„ˆí…Œì´ì…˜ì€ ë°ì´í„°ë² ì´ìŠ¤ê°€ ìë™ìœ¼ë¡œ IDë¥¼ ìƒì„±í•˜ë„ë¡ ì§€ì •(ì¦‰, AUTO_INCREMENTë¥¼ ì˜ë¯¸)í•œë‹¤. ë‹¤ë¥¸ í‚¤ ìƒì„± ì „ëµ(strategy)ì„ ì§€ì •í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ë‹¤. AUTO ìœ í˜•ì˜ ê²½ìš°ëŠ” JPAê°€ íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì— ì í•©í•œ ì „ëµì„ íƒí•œë‹¤ëŠ” ì˜ë¯¸ì´ë©°, default ìƒì„± ìœ í˜•ì— í•´ë‹¹í•œë‹¤. ë˜í•œ `@Id` ì• ë„ˆì—í‹°ì…˜ì„ ì—¬ëŸ¬ ì†ì„±ì— ì¶”ê°€í•˜ì—¬ ë³µí•© ê¸°ë³¸ í‚¤ë¥¼ ë§Œë“œëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ë‹¤.

- ë°ì´í„°ë² ì´ìŠ¤ì˜ ì»¬ëŸ¼ëª…ì€ ê¸°ë³¸ì ìœ¼ë¡œ í´ë˜ìŠ¤ í•„ë“œ ëª…ëª… ê·œì¹™ì— ë”°ë¼ ì§€ì •ëœë‹¤. ë‹¤ë¥¸ ëª…ëª…ê·œì¹™ì„ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´ `@Column` ì• ë„ˆí…Œì´ì…˜ì„ ì ìš©í•˜ë©´ ëœë‹¤. ê·¸ë¦¬ê³  ì»¬ëŸ¼ì˜ ê¸¸ì´ ë° ì»¬ëŸ¼ì˜ nullable ì—¬ë¶€ë¥¼ ì§€ì •í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ë‹¤.

```java
@Column(name="explanation", nullable=false, length=512)
private String description;
```

- ì´ë•Œ, id fieldê°€ ìë™ìƒì„±ì´ê¸° ë•Œë¬¸ì— Lombokì˜ AllArgsConstructorë¥¼ ì‚¬ìš©í•˜ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.

- ê·¸ë˜ì„œ ì¼ë‹¨ Lombokì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ë§Œë“¤ì—ˆë‹¤.
```java
package com.korit12.cardatabase.domain;

import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;

@Entity
public class Car {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;

    private String brand, model, color, registrationNumber;

    private int modelYear, price;

    // ê¸°ë³¸ ìƒì„±ì : JPAì—ì„œëŠ” ê¸°ë³¸ ìƒì„±ìê°€ í•„ìˆ˜
    public Car() {
    }
     
    // idë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ìƒì„±ì
    public Car(String brand, String model, String color, String registrationNumber, int modelYear, int price) {
        this.brand = brand;
        this.model = model;
        this.color = color;
        this.registrationNumber = registrationNumber;
        this.modelYear = modelYear;
        this.price = price;
    }

    public Long getId() {
        return id;
    }

    public String getBrand() {
        return brand;
    }

    public void setBrand(String brand) {
        this.brand = brand;
    }

    public String getModel() {
        return model;
    }

    public void setModel(String model) {
        this.model = model;
    }

    public String getColor() {
        return color;
    }

    public void setColor(String color) {
        this.color = color;
    }

    public String getRegistrationNumber() {
        return registrationNumber;
    }

    public void setRegistrationNumber(String registrationNumber) {
        this.registrationNumber = registrationNumber;
    }

    public int getModelYear() {
        return modelYear;
    }

    public void setModelYear(int modelYear) {
        this.modelYear = modelYear;
    }

    public int getPrice() {
        return price;
    }

    public void setPrice(int price) {
        this.price = price;
    }
}
```
- ì´í•˜ëŠ” Lombokì„ ì ìš©í•œ Car í´ë˜ìŠ¤ì´ë‹¤.
```java
package com.korit12.cardatabase.domain;

import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import lombok.*;

@Entity
@Data
@NoArgsConstructor
public class Car {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;

    @NonNull
    private String brand, model, color, registrationNumber;

    @NonNull
    private int modelYear, price;
}
```

## ğŸŸ¢ CRUD repository ë§Œë“¤ê¸°
- Spring Data JPAì—ëŠ” CRUD ì‘ì—…ì„ ìœ„í•œ `CrudRepository`ê°€ ì¡´ì¬í•œë‹¤. ì´ë¥¼ í†µí•´ì„œ CarRepositoryë¥¼ ë§Œë“¤ê³  extends ë°›ì•˜ë‹¤.

- ê·¸ë ‡ë‹¤ë©´ CarRepositoryëŠ” CrudRepositoryë¥¼ ìƒì† ë°›ì•˜ê¸° ë•Œë¬¸ì— ë‚´ë¶€ì— ìˆëŠ” ì¶”ìƒ ë©”ì„œë“œë“¤ì„ ì „ë¶€ ë‹¤ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

- ê·¸ëŸ°ë° repository.save() ë©”ì„œë“œë¥¼ ê³ ë ¤í–ˆì„ ë•Œ, ë‚´ë¶€ì˜ argumentë¡œ Car ê°ì²´ê°€ ë“¤ì–´ê°„ë‹¤. ì´ ë¶€ë¶„ì„ ì œì–´í•˜ëŠ” ê²ƒì´ Genericì„ ì´ìš©í•œ `<Car, Long>`ë¶€ë¶„ì´ì—ˆë‹¤.

```java
package com.korit12.cardatabase.domain;

import org.springframework.data.repository.CrudRepository;

public interface CarRepository extends CrudRepository<Car, Long> {
}
```
ì´ëŠ” CarRepositoryê°€ í…Œì´ë¸” ì—­í• ì„ í•˜ëŠ” ì—”í‹°í‹° í´ë˜ìŠ¤ì¸ Carì˜ ë¦¬í¬ì§€í† ë¦¬ ì—­í• ì„ í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ì´ë©°, idì˜ ìë£Œí˜•ì´ Longì„ì„ ëª…ì‹œí•œë‹¤.

- CRUD ê´€ë ¨ ë©”ì„œë“œ(HeidiSQL ìƒì—ì„œëŠ” ì¿¼ë¦¬ë¬¸ ì‘ì„± ì˜ì—­)ë“¤ì´ ì •ì˜ë˜ì–´ ìˆëŠ” ê³³.

### ëŒ€í‘œì ì¸ CRUD ê´€ë ¨ ë©”ì„œë“œ
1. `long count()` - ì—”í‹°í‹°ì˜ ìˆ˜ë¥¼ ë°˜í™˜
2. `Iterable<T> findAll()` - ì§€ì •í•œ íƒ€ì…ì˜ ëª¨ë“  í•­ëª©ì„ ë°˜í™˜
3. `Optional<T> findById(ID id)` - ì§€ì •í•œ IDì˜ í•œ í•­ëª©ì„ ë°˜í™˜
4. `void delete(T entity)` - íŠ¹ì • ì—”í‹°í‹° ì‚­ì œ
5. `void deleteAll()` - ë¦¬í¬ì§€í† ë¦¬ ë‚´ì˜ ëª¨ë“  ì—”í‹°í‹° ì‚­ì œ
6. `<S extends T> save(S entity)` - ì—”í‹°í‹°ë¥¼ ì €ì¥
7. `List<S> saveAll(Iterable<S> entities)` - ì—¬ëŸ¬ ì—”í‹°í‹°ë“¤ì„ í•œ ë²ˆì— ì €ì¥
- ì´ìƒì˜ ë©”ì„œë“œ ì¤‘ í•˜ë‚˜ì˜ í•­ëª©ë§Œì„ returní•  ë•ŒëŠ” T ëŒ€ì‹ ì— `Optional<T>`ë¥¼ ë°˜í™˜í•œë‹¤. Optional í´ë˜ìŠ¤ëŠ” Java 8 SEì— ë„ì…ëœ ìë£Œí˜•ìœ¼ë¡œ ê°’ì„ í¬í•¨í•˜ê±°ë‚˜ í¬í•¨í•˜ì§€ ì•ŠëŠ” ë‹¨ì¼ ê°’ ì»¨í…Œì´ë„ˆë‹¤. ê°’ì´ ì¡´ì¬í•˜ë©´ isPresent() ë©”ì„œë“œê°€ trueë¥¼ return, ì—†ìœ¼ë©´ falseë¥¼ returní•œë‹¤. ê·¸ëŸ°ë° ì–´ì¨‹ë“  ìë£Œí˜•ì´ Optionalì´ê¸° ë•Œë¬¸ì— if isPresent() {ì°¸ì¡°ìë£Œí˜•ìºìŠ¤íŒ…(from Optional to Car)} ê³¼ì •ì´ ìš”êµ¬ëœë‹¤. ê·¸ëŸ¬ë©´ get() ë©”ì„œë“œë¥¼ í†µí•´ì„œ ì¡´ì¬í•˜ëŠ” Car í´ë˜ìŠ¤ì˜ ê°ì²´ë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆë‹¤. ì´ëŠ” NullPointerExceptionì„ ë°©ì§€í•˜ê¸° ìœ„í•œ ë°©ë²•ì´ë‹¤.

### ë”ë¯¸ ë°ì´í„° ì¶”ê°€ ê³¼ì •
- H2 ì¸ë©”ëª¨ë¦¬ì— ë”ë¯¸ ë°ì´í„°ë¥¼ ì¶”ê°€í–ˆë‹¤. ì‹¤í–‰ë ë•Œë§ˆë‹¤ ì´ˆê¸°í™”ë˜ëŠ” íŠ¹ì„±ìƒ ë§¤ë²ˆ H2 ì¸ë©”ëª¨ë¦¬ DBì— INSERT í•˜ëŠ” ê²ƒì€ ë²ˆê±°ë¡­ê¸° ë•Œë¬¸ì— main ë‹¨ê³„ì— ë”ë¯¸ ë°ì´í„°ë“¤ì„ ì¼ê´„ ì¶”ê°€í–ˆë‹¤. 

- ì´ìƒì„ ìœ„í•´ CommandLineRunner ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í–ˆë‹¤. ê³¼ì •ì—ì„œ ì¶”ìƒ ë©”ì„œë“œë¥¼ êµ¬í˜„í•´ì•¼í•œë‹¤. (Override)

- ê·¸ë˜ì„œ CarRepositoryë‚´ì— ë”ë¯¸ ë°ì´í„°ë“¤ì„ ì§‘ì–´ë„£ë„ë¡ í•˜ê¸° ìœ„í•´ì„œ field ì„ ì–¸ì„ í†µí•´ CraRepository repository;ë¥¼ ì§‘ì–´ë„£ì—ˆê³ , í¬í•¨ëœ ìƒì„±ìë„ ë§Œë“¤ì—ˆë‹¤. ê·¸ë˜ì•¼ main ë‹¨ê³„ì—ì„œ CarRepositoryì˜ ë©”ì„œë“œì¸ .save()ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```java
package com.korit12.cardatabase;

import com.korit12.cardatabase.domain.Car;
import com.korit12.cardatabase.domain.CarRepository;
import lombok.RequiredArgsConstructor;
import org.slf4j.LoggerFactory;
import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.slf4j.Logger;

@SpringBootApplication
@RequiredArgsConstructor
public class CardatabaseApplication implements CommandLineRunner {
	private static final Logger logger = LoggerFactory.getLogger(CardatabaseApplication.class);

    public CardatabaseApplication(CarRepository repository) {
        this.repository = repository;
    }

    public static void main(String[] args) {
		SpringApplication.run(CardatabaseApplication.class, args);
		logger.info("ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.");
	}

	// field ì„ ì–¸
	private final CarRepository repository;

	@Override
	public void run(String... args) throws Exception {
		repository.save(new Car("í˜„ëŒ€", "ì†Œë‚˜íƒ€", "ê²€ì •", "123ê°€4567", 2026, 30000000));
		repository.save(new Car("ê¸°ì•„", "K9", "í°ìƒ‰", "987ë‚˜6543", 2025, 20000000));
		repository.save(new Car("ëŒë³´ë¥´ê¸°ë‹ˆ", "ì¿¤íƒ€ì¹˜", "ë¹¨ê°•", "159ë‹¤2468", 2010, 130000000));
	}
}
```

### Crud Repository ì‘ìš© ê³¼ì •
```java
package com.korit12.cardatabase.domain;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.CrudRepository;
import org.springframework.data.repository.PagingAndSortingRepository;

import java.util.List;

public interface CarRepository extends JpaRepository<Car, Long> {

    // CrudRepositoryì— ì—†ëŠ” ë©”ì„œë“œë¼ë©´ ì—¬ê¸°ì— ì •ì˜ë¥¼ í•´ì•¼ í•œë‹¤.
    // ì¿¼ë¦¬ëŠ” ì ‘ë‘ì‚¬(findBy)ë¡œ ì‹œì‘í•´ì•¼í•˜ê³ , ì¿¼ë¦¬ì— ì´ìš©í•  ì—”í‹°í‹° í´ë˜ìŠ¤ í•„ë“œë¥¼ ì •ì˜í•´ì•¼ í•œë‹¤.

    List<Car> findByBrand(String brand);

    // ìƒ‰ìƒìœ¼ë¡œ ê²€ìƒ‰, ê·¸ë¦¬ê³  ì—°ë„ë¡œ ê²€ìƒ‰í•˜ëŠ” ë©”ì„œë“œë¥¼ ì§ì ‘ ì •ì˜í•˜ì‹œì˜¤.
    List<Car> findByColor(String color);
    List<Car> findByModelYear(int modelYear);

    // SQL ìƒì—ì„œì˜ AND ë° OR ì—°ì‚°ìë„ ì ìš©ì´ ëœë‹¤.
    // ë¸Œëœë“œì™€ ëª¨ë¸ë¡œ ìë™ì°¨ ê²€ìƒ‰
    List<Car> findByBrandAndModel(String brand, String model);

    // ë¸Œëœë“œ ë˜ëŠ” ìƒ‰ìƒ ë³„ë¡œ ìë™ì°¨ ê²€ìƒ‰
    List<Car> findByBrandOrColor(String brand, String color);

    // ì •ë ¬ë„ ê°€ëŠ¥ - ë¸Œëœë“œë¡œ ê²€ìƒ‰í•˜ê³ , ì—°ë„ë¡œ ì •ë ¬
    List<Car> findByBrandOrderByModelYearAsc(String brand);

    // @Query ì• ë„ˆí…Œì´ì…˜ì„ ì´ìš©í•´ì„œ SQLë¬¸ ìì²´ë¥¼ ì‘ì„±í•  ìˆ˜ë„ ìˆë‹¤.
    // ëª¨ë¸ëª…ìœ¼ë¡œ ê²€ìƒ‰
    @Query("select c from Car c where c.model = ?1")
    List<Car> findByModel(String model);
    // ì´ìƒì˜ ê²½ìš°ì—ëŠ” ì¼ì¹˜í•˜ëŠ” ê²ƒë§Œ êµ¬í• ìˆ˜ê°€ ìˆëŠ”ë°, @Queryë¥¼ ì“°ëŠ” ì´ìœ ëŠ” LIKE ì—°ì‚°ìê°€ ì‚¬ìš© ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

    @Query("select c from Car c where c.brand like %?1")
    List<Car> findByBrandEndWith(String brand);

    // ë‹¤ë§Œ @Queryë¥¼ ì“°ê²Œ ë˜ë©´ ë‹¤ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ë¡œì˜ ì´ì‹ì„±ì´ ì¡°ê¸ˆ ë–¨ì–´ì§„ë‹¤.

}
```
CrudRepositoryë¶€í„° í™•ì¥ëœ PaginAndSortingRepositoryë„ ìˆë‹¤. í˜ì´ì§• ë° ì •ë ¬ì„ í†µí•´ ì—”í‹°í‹° í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê²€ìƒ‰í•˜ëŠ” ë©”ì„œë“œë¥¼ ì¶”ê°€ ì œê³µí•œë‹¤. ì´ëŠ” ëŒ€ê·œëª¨ ê²°ê³¼ ì§‘í•©ì—ì„œ ëª¨ë“  ë°ì´í„°ë¥¼ returní•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— ëŒ€ê·œëª¨ ë°ì´í„° ì²˜ë¦¬ì— ì í•©í•œ í˜•íƒœì´ë‹¤. CrudRepositoryì—ì„œ ì¶”ê°€ëœ ë©”ì„œë“œê°€ 2ê°œ ë” ìˆë‹¤.

1. `Iterable<T> findAll(Sort sort)` - ì§€ì •ëœ ì˜µì…˜ìœ¼ë¡œ ì •ë ¬ëœ ëª¨ë“  ì—”í‹°í‹°ë¥¼ ë°˜í™˜
2. `Page<T> findAll(Pageable pageable)` - ì§€ì •ëœ í˜ì´ì§• ì˜µì…˜ìœ¼ë¡œ ëª¨ë“  ì—”í‹°í‹°ë¥¼ ë°˜í™˜


í•˜ì§€ë§Œ ìµœì¢…ì ìœ¼ë¡œëŠ” ì¢…í•© íŒ¨í‚¤ì§€ì— í•´ë‹¹í•˜ëŠ” `JpaRepository`ë¥¼ extends ë°›ì„ ê²ƒì´ë‹¤.

## ğŸŸ¢ í…Œì´ë¸” ê°„ì˜ ê´€ê³„ ì¶”ê°€ - JOIN ê´€ë ¨
- ê³¼ì œ : Owner entity í´ë˜ìŠ¤ë¥¼ ì •ì˜í•˜ì‹œì˜¤.
- field
    - ownerId : PK ì—­í• 
    - firstName / lastName

- ìƒì„±ì / Getter / Setterë¥¼ ë¡¬ë³µì„ ì‚¬ìš©í•˜ì—¬ ì •ì˜í•˜ì‹œì˜¤.
- OwnerRepositoryë¥¼ ìƒì„±í•˜ê³  JpaRepositoryë¥¼ ìƒì†í•˜ì‹œì˜¤.
- ê·¸ë¦¬ê³  ì‹¤í–‰í•´ì„œ Owner í…Œì´ë¸”ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ì‹œì˜¤.

- Car ë° Owner í…Œì´ë¸”ì— ì¼ëŒ€ë‹¤ ê´€ê³„(1:N)ë¥¼ ì„¤ì •. ì¼ëŒ€ë‹¤ ê´€ê³„ë€ í•œ ëª…ì´ ìë™ì°¨ ì—¬ëŸ¬ ëŒ€ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆì§€ë§Œ, í•œ ìë™ì°¨ì˜ ì†Œìœ ìëŠ” í•œ ëª…ì´ë¼ëŠ” ì˜ë¯¸ì´ë‹¤.

- ì¼ëŒ€ë‹¤ ê´€ê³„ë¥¼ ì¶”ê°€í•˜ë ¤ë©´ `@ManyToOne` / `@OneToMany` ì• ë„ˆì—í‹°ì…˜ì„ ì´ìš©í•´ì•¼ í•œë‹¤. ì™¸ë˜ í‚¤ë¥¼ í¬í•¨í•œ Car ì—”í‹°í‹° í´ë˜ìŠ¤ì—ì„œëŠ” `@ManyToOne` ì• ë„ˆí…Œì´ì…˜ ì ìš©, ê·¸ë¦¬ê³  ì†Œìœ ì fieldì— ëŒ€í•œ Getter / Setterë„ ì¶”ê°€í•´ì•¼ í•œë‹¤. (ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì ì€ onwerIdë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ Ownerë¥¼ ì¶”ê°€í•œë‹¤ëŠ” ì ) ëª¨ë“  ì—°ê´€ ê´€ê³„ì—ì„œ FetchType.LAZYë¥¼ ì´ìš©í•  ê²ƒì´ë‹¤. ëŒ€ë‹¤(toMany) ê´€ê³„ì—ì„œëŠ” FetchType.LAZYê°€ defaultì´ì§€ë§Œ ëŒ€ì¼(toOne) ê´€ê³„ì—ì„œëŠ” ì •ì˜ë¥¼ ì¶”ê°€ì ìœ¼ë¡œ í•´ì¤˜ì•¼ í•œë‹¤.

ğŸ“ fetch typeì´ë€ ?  
ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•˜ëŠ” ì „ëµì„ ì˜ë¯¸í•˜ëŠ”ë°, ì§€ì • ê°€ëŠ¥í•œ ê°’ì€ ì¦‰ì‹œ ê²€ìƒ‰ì„ ìš”ì²­í•˜ëŠ” EAGERê°€ ìˆê³ , ì§€ì—° ê²€ìƒ‰ì„ í—ˆìš©í•˜ëŠ” LAZYê°€ ì¡´ì¬í•œë‹¤. ì˜ˆì œì—ì„œ ì“¸ LAZYì˜ ì˜ë¯¸ëŠ” ì†Œìœ ìë¥¼ ê²€ìƒ‰í–ˆì„ ê²½ìš°(ì¦‰, OwnerRepositoryì— ìˆëŠ” ë©”ì„œë“œë¥¼ í˜¸ì¶œí–ˆì„ ê²½ìš°) í•´ë‹¹ ì†Œìœ ìì™€ ê´€ë ¨ëœ ëª¨ë“  ìë™ì°¨ë¥¼ ê²€ìƒ‰í•œë‹¤ëŠ” ëœ»ì´ ëœë‹¤. ë°˜ë©´ ì¦‰ì‹œ ê²€ìƒ‰(EAGER)ëŠ” í•´ë‹¹ ì†Œìœ ìì˜ ëª¨ë“  ìë™ì°¨ë¥¼ ì¦‰ì‹œ ê²€ìƒ‰í•œë‹¤.

```java
// Car.java
package com.korit12.cardatabase.domain;

import jakarta.persistence.*;
import lombok.*;

@Entity
@Data
@NoArgsConstructor
@RequiredArgsConstructor
public class Car {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;

    @NonNull
    private String brand, model, color, registrationNumber;

    @NonNull
    private int modelYear, price;
    
    @ManyToOne
    @JoinColumn(name = "owner")
    private Owner owner;        // @NonNullì´ ì—†ìœ¼ë‹ˆ ì˜µì…”ë„ì´ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤.
}

// Owner.java
package com.korit12.cardatabase.domain;

import jakarta.persistence.*;
import lombok.*;

import java.util.List;

@Entity
@NoArgsConstructor
@RequiredArgsConstructor
public class Owner {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    @Getter
    private Long ownerId;

    @Getter @Setter @NonNull
    private String firstName, lastName;

    @OneToMany(cascade = CascadeType.ALL, mappedBy = "owner")
    @Getter @Setter
    private List<Car> cars;
}
```
- ì´ìƒì˜ ì½”ë“œê°€ Entity í´ë˜ìŠ¤ë“¤ ê°„ì˜ JOIN ê´€ê³„ë¥¼ Javaë¡œ í‘œí˜„í•œ ì˜ˆì‹œê°€ ëœë‹¤. OwnerëŠ” ìë™ì°¨ë¥¼ ì—¬ëŸ¬ ëŒ€ ê°€ì§ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ `List<Car> cars` fieldë¥¼ ê°€ì§„ë‹¤.
- `@OneToMany` ì• ë„ˆí…Œì´ì…˜ì€ ë‘ ê°€ì§€ íŠ¹ì„±ì´ ìˆëŠ”ë°,
  1. cascade ì†ì„±ì€ ì‚­ì œ ë° ì—…ë°ì´íŠ¸ ì‹œ ì—°ì† íš¨ê³¼ê°€ ì ìš©ë˜ëŠ” ë°©ë²•ì„ ì§€ì •í•œë‹¤. (HeidiSQLì—ì„œ restricted ê±¸ì–´ë‘” ë¶€ë¶„) ê·¸ëŸ°ë° ì˜ˆì‹œì—ì„œëŠ” cascadeë¥¼ ALLë¡œ ì¡ì•„ë†¨ê¸° ë•Œë¬¸ì— ì†Œìœ ì í•œëª…ì„ ì‚­ì œí–ˆì„ ê²½ìš° ìë™ì°¨ë“¤ë„ ê°™ì´ ì‚­ì œëœë‹¤. 
![alt text](image.png)

```sql
SELECT o.owner_id, * FROM CAR c INNER JOIN OWNER o ON c.owner = o.owner_id;
```


## ğŸŸ¢ MariaDB ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
- ì†Œí”„íŠ¸ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©. h2 ì¸ë©”ëª¨ë¦¬ ë°ì´í„°ë² ì´ìŠ¤ëŠ” í…ŒìŠ¤íŠ¸ì™€ ì‹œì—° ëª©ì ìœ¼ë¡œëŠ” ì¢‹ì§€ë§Œ ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒê³¼ ê°™ì€ ìƒí™©ì—ì„œ ë¬¸ì œê°€ ìƒê¸´ë‹¤. ì„±ëŠ¥ / ì•ˆì •ì„± / í™•ì¥ì„±ì´ í•„ìš”í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê³ ë ¤í•˜ì—¬ MariaDBë¡œ ì´ì‚¬í•˜ê² ë‹¤.
1. HeidiSQLì„ í‚¨ë‹¤. -> cardb ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
2. build.gradle ìˆ˜ì •í•œë‹¤. (h2 ë¹¼ê³ , mariadb ì¶”ê°€)
```java
runtimeOnly 'org.mariadb.jdbc:mariadb-java-client'
```
3. application.propertiesë„ ìˆ˜ì •í•œë‹¤.
```java
spring.application.name=cardatabase
spring.datasource.url=jdbc:mariadb://localhost:3310/cardb
spring.datasource.username=root
spring.datasource.password=1234
spring.datasource.driver-class-name=org.mariadb.jdbc.Driver
spring.jpa.generate-ddl=true
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.show-sql=true
```


# ğŸš¨ë°œìƒí•œ ë¬¸ì œ


# ğŸ“– ë³µìŠµ & í™•ì¸
âœ”ï¸ ë‚´ìš©
ğŸ’¡ğŸ“ŒğŸ“ğŸš©ğŸš¨âš ï¸